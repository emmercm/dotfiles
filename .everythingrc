# Bash: .bash_profile (macOS default) -> .profile (Ubuntu default) -> .bashrc -> .everythingrc
# zsh:  .zshrc (always executed) -> .everythingrc

SHELL=$(which "$(ps -o comm= $$ | sed 's/^-*//')")


##### Bash #####

# Reload this file after change
reload() {
    exec "${SHELL}"
}


##### Misc #####

__bashrc_misc() {
    # `which` but better
    #   https://emmer.dev/blog/reliably-finding-files-in-path/
    pinpoint() {
        while read -r DIR; do
            if [[ -f "${DIR}/$1" ]]; then
                echo "${DIR}/$1"
                return 0
            fi
        done <<< "$(echo "${PATH}" | tr ':' '\n')"
        return 1
    }

    # Don't be a savage
    if command -v nano &> /dev/null; then
        EDITOR=$(pinpoint nano)
        export EDITOR
    fi

    # Navigation helpers
    alias ..="cd .."
    alias ...="cd ../.."
    alias ....="cd ../../.."
    alias .....="cd ../../../.."

    # Colorize various commands
    # shellcheck disable=SC2139,SC2262
    alias ls="command ls $(if ls --color &> /dev/null; then echo "--color"; else echo "-G"; fi)"
    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
    command -v tree > /dev/null && alias tree='tree -C'

    # cat shortcuts
    cathex() {
        xxd -p "$@" | tr -d '\n' | awk '{print $1}'
    }

    # ls shortcuts
    alias ll="ls -alF"
    lsd() {
        for DIR in "${@:-.}"/*; do
            if [[ -d "${DIR}" ]]; then
                echo "${DIR}"
            fi
        done
    }
    lsf() {
        for FILE in "${@:-.}"/*; do
            if [[ ! -d "${FILE}" ]]; then
                echo "${FILE}"
            fi
        done
    }

    # Jokes
    alias please="sudo"
    alias yeet="rm -rf"

    # Polyfills
    if ! command -v beep &> /dev/null; then
        alias beep="echo -ne '\007'"
    fi
}
__bashrc_misc


##### IDEs #####

__bashrc_ides() {
    if [[ -d "/Applications/Visual Studio Code.app/Contents/Resources/app/bin" ]]; then
        export PATH="$PATH:/Applications/Visual Studio Code.app/Contents/Resources/app/bin"
    fi
    if [[ -d "/Applications/VSCodium.app/Contents/Resources/app/bin" ]]; then
        export PATH="$PATH:/Applications/VSCodium.app/Contents/Resources/app/bin"
        alias code=codium
    fi
}
__bashrc_ides


##### Everything Else #####

while read -r FILE; do
    # shellcheck disable=SC1090
    source "${FILE}"
done <<< "$(find ~/.dotpack -maxdepth 1 -follow -type f -name ".*.sh" | sort --version-sort)"

if [[ "$(basename "${SHELL}")" == "bash" ]]; then
    while read -r FILE; do
        # shellcheck disable=SC1090
        source "${FILE}"
    done <<< "$(find ~/.dotpack -maxdepth 1 -follow -type f -name ".*.bash" | sort --version-sort)"
fi

if [[ "$(basename "${SHELL}")" == "zsh" ]]; then
    while read -r FILE; do
        # shellcheck disable=SC1090
        source "${FILE}"
    done <<< "$(find ~/.dotpack -maxdepth 1 -follow -type f -name ".*.zsh" | sort --version-sort)"
fi
